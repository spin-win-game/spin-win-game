<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Spin & Win Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
</head>

<body style="font-family: Arial; padding: 20px;">

  <h1>ðŸŽ¯ Spin & Win Game</h1>

  <!-- LOGIN SECTION -->
  <div id="loginSection">
    <input type="text" id="phone" placeholder="+91XXXXXXXXXX" />
    <button onclick="sendOTP()">Send OTP</button><br><br>

    <input type="text" id="otp" placeholder="Enter OTP" />
    <button onclick="verifyOTP()">Verify OTP</button>
  </div>

  <div id="recaptcha-container"></div>

  <!-- USER INFO -->
  <div id="userSection" style="display:none;">
    <h3>Welcome ðŸŽ‰</h3>
    <p id="userPhone"></p>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- ADMIN PANEL -->
  <div id="adminPanel" style="display:none; margin-top:30px;">
    <h2>ðŸ‘‘ Admin Panel</h2>
    <button onclick="loadUsers()">Load Users</button>
    <div id="users"></div>
  </div>

  <!-- FIREBASE SDKs (CDN) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    // ðŸ”¥ YOUR FIREBASE CONFIG
    const firebaseConfig = {
      apiKey: "AIzaSyAq__wm_HU38MrY4ndT1G6xfz5uYmVRHwM",
      authDomain: "spin-win-game-43e01.firebaseapp.com",
      projectId: "spin-win-game-43e01",
      storageBucket: "spin-win-game-43e01.firebasestorage.app",
      messagingSenderId: "252479339776",
      appId: "1:252479339776:web:7ca76c10e248e1269907e5"
    };

    // INIT FIREBASE
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    // RECAPTCHA
    window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier(
      'recaptcha-container',
      { size: 'invisible' }
    );

    // SEND OTP
    function sendOTP() {
      const phone = document.getElementById("phone").value;
      auth.signInWithPhoneNumber(phone, window.recaptchaVerifier)
        .then((confirmationResult) => {
          window.confirmationResult = confirmationResult;
          alert("OTP Sent");
        })
        .catch(alert);
    }

    // VERIFY OTP
    function verifyOTP() {
      const otp = document.getElementById("otp").value;
      confirmationResult.confirm(otp).then((result) => {
        saveUser(result.user);
      }).catch(alert);
    }

    // SAVE USER
    function saveUser(user) {
      db.collection("users").doc(user.uid).set({
        phone: user.phoneNumber,
        uid: user.uid,
        role: "user",
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      }, { merge: true });
    }

    // AUTH STATE
    auth.onAuthStateChanged(async (user) => {
      if (!user) return;

      document.getElementById("loginSection").style.display = "none";
      document.getElementById("userSection").style.display = "block";
      document.getElementById("userPhone").innerText = user.phoneNumber;

      const doc = await db.collection("users").doc(user.uid).get();
      if (doc.exists && doc.data().role === "admin") {
        document.getElementById("adminPanel").style.display = "block";
      }
    });

    // LOAD USERS (ADMIN)
    function loadUsers() {
      db.collection("users").get().then(snapshot => {
        let html = "";
        snapshot.forEach(doc => {
          html += `<p>${doc.data().phone} | ${doc.data().role}</p>`;
        });
        document.getElementById("users").innerHTML = html;
      });
    }

    // LOGOUT
    function logout() {
      auth.signOut();
      location.reload();
    }
  </script>

</body>
</html>
